import { createApi } from '@reduxjs/toolkit/query/react';import { baseQuery } from './base';export interface Student {  id: string;  firstName: string;  lastName: string;  email: string;  studentId: string;  yearOfStudy: number;  major: string;  gpa?: number;  phone?: string;  createdAt: string;  updatedAt: string;  universityId: string;  university?: {    id: string;    name: string;  };  skills: StudentSkill[];}export interface StudentSkill {  id: string;  level: number;  skillId: string;  skill: {    id: string;    name: string;    category: string;    description?: string;  };}export interface CreateStudentDto {  firstName: string;  lastName: string;  email: string;  studentId: string;  yearOfStudy: number;  major: string;  gpa?: number;  phone?: string;}export interface UpdateStudentDto {  firstName?: string;  lastName?: string;  email?: string;  studentId?: string;  yearOfStudy?: number;  major?: string;  gpa?: number;  phone?: string;}export interface StudentSearchParams {  skillIds: string[];  minLevel?: number;  maxLevel?: number;}export interface StudentStats {  totalStudents: number;  studentsWithSkills: number;  studentsWithoutSkills: number;  topSkills: Array<{    skillId: string;    _count: {      skillId: number;    };  }>;}export interface AddStudentSkillDto {  skillId: string;  level: number;}export interface UpdateStudentSkillDto {  level: number;}export const studentsApi = createApi({  reducerPath: 'studentsApi',  baseQuery,  tagTypes: ['Student', 'StudentSkill', 'StudentStats'],  endpoints: (builder) => ({    createStudent: builder.mutation<Student, CreateStudentDto>({      query: (studentData) => {        const userRole = typeof window !== 'undefined' ? localStorage.getItem('userRole') : null;        const isAdmin = userRole === 'ADMIN' || userRole === 'MODERATOR';        return {          url: isAdmin ? '/admin/students' : '/universities/students',          method: 'POST',          body: studentData,        };      },      invalidatesTags: ['Student', 'StudentStats'],    }),    getStudents: builder.query<Student[], void>({      query: () => {        const userRole = typeof window !== 'undefined' ? localStorage.getItem('userRole') : null;        const isAdmin = userRole === 'ADMIN' || userRole === 'MODERATOR';        return isAdmin ? '/admin/students' : '/universities/students';      },      providesTags: ['Student'],    }),    getStudent: builder.query<Student, string>({      query: (id) => {        const userRole = typeof window !== 'undefined' ? localStorage.getItem('userRole') : null;        const isAdmin = userRole === 'ADMIN' || userRole === 'MODERATOR';        return isAdmin ? `/admin/students/${id}` : `/universities/students/${id}`;      },      providesTags: (result, error, id) => [{ type: 'Student', id }],    }),    updateStudent: builder.mutation<Student, { id: string; data: UpdateStudentDto }>({      query: ({ id, data }) => {        const userRole = typeof window !== 'undefined' ? localStorage.getItem('userRole') : null;        const isAdmin = userRole === 'ADMIN' || userRole === 'MODERATOR';        return {          url: isAdmin ? `/admin/students/${id}` : `/universities/students/${id}`,          method: 'PATCH',          body: data,        };      },      invalidatesTags: (result, error, { id }) => [        { type: 'Student', id },        'Student',        'StudentStats'      ],    }),    deleteStudent: builder.mutation<{ message: string }, string>({      query: (id) => {        const userRole = typeof window !== 'undefined' ? localStorage.getItem('userRole') : null;        const isAdmin = userRole === 'ADMIN' || userRole === 'MODERATOR';        return {          url: isAdmin ? `/admin/students/${id}` : `/universities/students/${id}`,          method: 'DELETE',        };      },      invalidatesTags: ['Student', 'StudentStats'],    }),    searchStudents: builder.query<Student[], StudentSearchParams>({      query: ({ skillIds, minLevel, maxLevel }) => {        const params = new URLSearchParams();        params.append('skillIds', skillIds.join(','));        if (minLevel !== undefined) {          params.append('minLevel', minLevel.toString());        }        if (maxLevel !== undefined) {          params.append('maxLevel', maxLevel.toString());        }        const userRole = typeof window !== 'undefined' ? localStorage.getItem('userRole') : null;        const isAdmin = userRole === 'ADMIN' || userRole === 'MODERATOR';        return isAdmin ? `/admin/students/search?${params.toString()}` : `/universities/students/search?${params.toString()}`;      },      providesTags: ['Student'],    }),    getStudentStats: builder.query<StudentStats, void>({      query: () => {        const userRole = typeof window !== 'undefined' ? localStorage.getItem('userRole') : null;        const isAdmin = userRole === 'ADMIN' || userRole === 'MODERATOR';        return isAdmin ? '/admin/students/stats' : '/universities/students/stats';      },      providesTags: ['StudentStats'],    }),    addStudentSkill: builder.mutation<StudentSkill, { studentId: string; data: AddStudentSkillDto }>({      query: ({ studentId, data }) => ({        url: `/skills/student/${studentId}`,        method: 'POST',        body: data,      }),      invalidatesTags: (result, error, { studentId }) => [        { type: 'Student', id: studentId },        'Student',        'StudentSkill'      ],    }),    getStudentSkills: builder.query<StudentSkill[], string>({      query: (studentId) => `/skills/student/${studentId}`,      providesTags: (result, error, studentId) => [        { type: 'StudentSkill', id: studentId }      ],    }),    updateStudentSkill: builder.mutation<StudentSkill, { studentId: string; skillId: string; data: UpdateStudentSkillDto }>({      query: ({ studentId, skillId, data }) => ({        url: `/skills/student/${studentId}/${skillId}`,        method: 'PATCH',        body: data,      }),      invalidatesTags: (result, error, { studentId }) => [        { type: 'Student', id: studentId },        { type: 'StudentSkill', id: studentId },        'Student'      ],    }),    removeStudentSkill: builder.mutation<{ message: string }, { studentId: string; skillId: string }>({      query: ({ studentId, skillId }) => ({        url: `/skills/student/${studentId}/${skillId}`,        method: 'DELETE',      }),      invalidatesTags: (result, error, { studentId }) => [        { type: 'Student', id: studentId },        { type: 'StudentSkill', id: studentId },        'Student'      ],    }),  }),});export const {  useCreateStudentMutation,  useGetStudentsQuery,  useGetStudentQuery,  useUpdateStudentMutation,  useDeleteStudentMutation,  useSearchStudentsQuery,  useLazySearchStudentsQuery,  useGetStudentStatsQuery,  useAddStudentSkillMutation,  useGetStudentSkillsQuery,  useUpdateStudentSkillMutation,  useRemoveStudentSkillMutation,} = studentsApi;
